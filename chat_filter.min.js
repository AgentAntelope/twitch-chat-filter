(function(){"use strict";function l(e,t){if(e.length===0)return t.length;if(t.length===0)return e.length;var n=[];for(var r=0;r<=t.length;r++){n[r]=[r]}for(var i=0;i<=e.length;i++){n[0][i]=i}for(var r=1;r<=t.length;r++){for(var i=1;i<=e.length;i++){if(t.charAt(r-1)==e.charAt(i-1)){n[r][i]=n[r-1][i-1]}else{n[r][i]=1+Math.min(n[r-1][i-1],n[r][i-1],n[r-1][i])}}}return n[t.length][e.length]}function h(t){if(c.test(t))return true;for(var n=0;n<e.length;n++){var i=e[n];if(l(i,t)<=r){return true}}return false}function p(e){e=e.toLowerCase();var t=e.split(/[\d\s]+/);for(var n=0;n<t.length;n++){var r=t[n];if(!r)continue;if(!h(r))return false}return true}function d(e){e=e.toLowerCase();var n=0;for(var r=0;r<t.length;r++){if(e.indexOf(t[r])!=-1){n++;if(n>1){return true}}}return false}function v(e){for(var t=0;t<n.length;t++){if(0<=e.indexOf(n[t])){return true}}return false}function m(e){e=e.toLowerCase();var t=e.match(f.linkify_re);if(!t)return false;for(var n=0;n<t.length;n++){if(!v(t[n])){return true}}return false}function g(e){var t=0;for(var n=0;n<e.length;n++){if(e.charCodeAt(n)>127){t++;if(t>i){return true}}}return false}function y(e){return e.split(/\s/g).length<s}function b(e){return/[\u0400-\u04FF]/.test(e)}function w(e){return e.replace(/(.{4}.*?)(\s*?\1)+/g,"$1")}function T(e){for(var t=0;t<E.length;t++){var n=E[t];if(n.isActive&&n.predicate(e)){return false}}return true}function N(e){var t=e;for(var n=0;n<S.length;n++){var r=S[n];if(r.isActive){t=r.rewriter(t)||t}}return t}function C(){function n(t,n){e.append('<p class="dropmenu_action"><label for="'+t.name+'" class="filter_option"> <input type="checkbox" id="'+t.name+'">'+t.comment+"</label></p>");a("#"+t.name).on("change",function(){t.isActive=a(this).prop("checked");n(t)}).prop("checked",t.isActive)}function r(e){if(e.isActive)a(e.element).addClass(e.class);else a(e.element).removeClass(e.class)}a("#chat_viewers_dropmenu_button").after('<a id="chat_filter_dropmenu_button" class="dropdown_glyph"><span></span><a>');a("#chat_filter_dropmenu_button").on("click",function(){a("#chat_filter_dropmenu").toggle()});a("#chat_filter_dropmenu_button span").css("background","url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAv0lEQVQ4jc3SIQ7CQBAF0C8rK5E9AhI5R1gccpLOn+UACARHwCO5Aq6HQHAUQsAhwJGmlNBdIOEnY18mfwb4u4hIYWaSOySnAABVrWKMt9xx97OqVlDVkbufPoAuZiYAgBBC6e5NBnJQ1eqpK5KbBKQJIZQvyyc5f4eQ3A66pJlJjLG3N3dfJr0FyUUHudZ1PUtCWls9IDPbJyN90OBeulHV8beg6lfQKgsSkaJ18qOZTbIgAHD3NcmdiBTZSGruBIYOSjStwb0AAAAASUVORK5CYII=)").css("position","relative");a("#chat_speak").css("width","149px");a("#controls").append('<div id="chat_filter_dropmenu" class="dropmenu menu-like" style="position:absolute; bottom:45px; display:none;"><p style="margin-left:6px">Hide:</p></div>');var e=a("#chat_filter_dropmenu");var t=["#chat_line_list .TppFiltered {display:none;} .filter_option{font-weight:normal; margin-bottom:0; color: #B9A3E3;}","#chat_line_list.allcaps_filtered span.chat_line{text-transform:lowercase;}"];a("head").append("<style>"+t.join("")+"</style>");E.forEach(function(e){n(e,k)});a("#chat_filter_dropmenu").append('<p style="margin-left:6px;">Automatically rewrite:</p>');S.forEach(function(e){n(e,function(e){})});x.forEach(function(e){n(e,r);r(e)})}function k(){if(!f)return;a("#chat_line_list li").each(function(){var e=a(this);var t=e.find(".chat_line").text();if(T(t)){e.removeClass("TppFiltered")}else{e.addClass("TppFiltered")}})}function L(){f=o.CurrentChat;k();var e=f.insert_chat_line;f.insert_chat_line=function(t){if(!T(t.message)){return false}t.message=N(t.message);return e.apply(this,arguments)}}var e=["left","right","up","down","start","select","a","b","democracy","anarchy","wait"];var t=["misty","guys","we have to","we need to","beat"];var n=["github.com","reddit.com","webchat.freenode.net/?channels=twitchplayspokemon","sites.google.com/site/twitchplayspokemonstatus/","www.reddit.com/live/sw7bubeycai6hey4ciytwamw3a","strawpoll.me","imgur.com","pokeworld.herokuapp.com"];var r=2;var i=2;var s=2;var o;try{o=unsafeWindow}catch(u){o=window}var a=o.jQuery;var f=null;var c=new RegExp("^(("+e.join("|")+")\\d*)+$","i");var E=[{name:"TppFilterCommand",comment:"Commands (up, down, anarchy, etc)",isActive:true,predicate:p},{name:"TppFilterLink",comment:"Non-whitelisted URLs",isActive:true,predicate:m},{name:"TppFilterDonger",comment:"Ascii art and dongers",isActive:false,predicate:g},{name:"TppFilterSmall",comment:"One-word messages",isActive:false,predicate:y},{name:"TppFilterSpam",comment:"Misty spam",isActive:true,predicate:d},{name:"TppFilterCyrillic",comment:"Cyrillic characters",isActive:true,predicate:b}];var S=[{name:"TppFilterDuplicateURL",comment:"Copy pasted repetitions",isActive:true,rewriter:w}];var x=[{name:"TppConvertAllcaps",comment:"Lowercase-only mode",isActive:true,element:"#chat_line_list","class":"allcaps_filtered"}];a(function(){var e=setInterval(function(){if(a("#chat_loading_spinner").css("display")=="none"){clearInterval(e);C();L()}},100)})})()
