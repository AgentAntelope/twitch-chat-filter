(function(){"use strict";function l(e,t){if(e.length===0)return t.length;if(t.length===0)return e.length;var n=[];for(var r=0;r<=t.length;r++){n[r]=[r]}for(var i=0;i<=e.length;i++){n[0][i]=i}for(var r=1;r<=t.length;r++){for(var i=1;i<=e.length;i++){if(t.charAt(r-1)==e.charAt(i-1)){n[r][i]=n[r-1][i-1]}else{n[r][i]=1+Math.min(n[r-1][i-1],n[r][i-1],n[r-1][i])}}}return n[t.length][e.length]}function h(t){if(c.test(t))return true;for(var n=0;n<e.length;n++){var r=e[n];if(l(r,t)<=i){return true}}return false}function p(e){e=e.toLowerCase();var t=e.split(/[\d\s]+/);for(var n=0;n<t.length;n++){var r=t[n];if(!r)continue;if(!h(r))return false}return true}function d(e){e=e.toLowerCase();var t=0;for(var r=0;r<n.length;r++){if(e.indexOf(n[r])!=-1){t++;if(t>1){return true}}}return false}function v(e){for(var t=0;t<r.length;t++){if(0<=e.indexOf(r[t])){return true}}return false}function m(e){e=e.toLowerCase();var t=e.match(u.CurrentChat.linkify_re);if(!t)return false;for(var n=0;n<t.length;n++){if(!v(t[n])){return true}}return false}function g(e){var t=0;for(var n=0;n<e.length;n++){if(e.charCodeAt(n)>127){t++;if(t>s){return true}}}return false}function y(e){return e.split(/\s/g).length<o}function b(e){return e.toUpperCase()===e}function w(e){e=e.toLowerCase();for(var n=0;n<t.length;n++){if(e.indexOf(t[n])!==-1){return true}}return false}function x(e){e=f.trim(e);var t=[];S.forEach(function(n){if(n.predicate(e)){t.push(n.name)}});return t}function k(e,t){C.forEach(function(n){if(n.def){e=n.predicate(e,t)}});return e}var e=["left","right","up","down","start","select","a","b","democracy","anarchy","wait"];var t=["misty"];var n=["misty","guys","we have to","we need to","beat"];var r=["github.com","reddit.com","webchat.freenode.net/?channels=twitchplayspokemon","sites.google.com/site/twitchplayspokemonstatus/","www.reddit.com/live/sw7bubeycai6hey4ciytwamw3a","strawpoll.me","imgur.com","pokeworld.herokuapp.com"];var i=2;var s=2;var o=2;var u;try{u=unsafeWindow}catch(a){u=window}var f=u.jQuery;var c=new RegExp("^(("+e.join("|")+")\\d*)+$","i");var E=function(e){var t=new RegExp(""+"(\\.[^\\.\\s]{1,3}"+"(?:/[^\\.\\s]+"+"(?:\\.[^\\.\\s]{1,3})?"+")?"+"(?:\\?[^\\.\\s]+\\=[^\\.\\s]+"+"(?:&[^\\.\\s]+\\=[^\\.\\s]+])*"+")?)","gi");var n=[];var r;while((r=t.exec(e))!==null){var i=/(\S*\=)\S*?/gi.exec(r[1]);if(i==null){n.push(r[1])}else{n.push(i[1])}}if(n!=null){var s={};for(var o=0;o<n.length;++o){var u=n[o];if(Object.prototype.hasOwnProperty.call(s,u)){return true}s[u]=true}}return false};var S=[{name:"TppFilterCommand",comment:"Hide commands (up, down, anarchy, etc)",def:true,predicate:p},{name:"TppFilterLink",comment:"Hide messages with non-whitelisted URLs",def:true,predicate:m},{name:"TppFilterDuplicateURL",comment:"Hide duplicate URLS",def:true,predicate:E},{name:"TppFilterDonger",comment:"Hide dongers and ascii art. ヽ༼ຈل͜ຈ༽ﾉ",def:false,predicate:g},{name:"TppFilterSmall",comment:'Hide one-word messages (Kappa, "yesss!", etc)',def:false,predicate:y},{name:"TppFilterUppercase",comment:"Hide ALLCAPS",def:false,predicate:b},{name:"TppFilterSpam",comment:'Hide common spam ("MISTY")',def:false,predicate:w},{name:"TppFilterMisty",comment:"Hide 'Guys we have to beat misty' spam. (More selective)",def:true,predicate:d}];var T=function(e,t){var n=function(e,t,r,i,s,o,u){var a=t.replace(/(.*)(@)(\w+)(.*)/i,n);if(t==a){a='<span class="chat_line">'+a+"</span>"}var f='<span class="chat_line_directed">'+r+"</span>";var l='<span class="chat_line_directed_username">'+i+"</span>";var c='<span class="chat_line">'+s+"</span>";return a+f+l+c};var r=t.replace(/(.*)(@)(\w+)(.*)/i,n);if(r!=t){e=e.replace(/<span class=\"chat_line\">.*<\/span>/i,r)}return e};var N=function(e,t){if(t===t.toUpperCase()){var n=function(e,t,n){return e.toLowerCase()};return e.replace(/>.*</ig,n)}return e};var C=[{name:"TppGUIColorDirected",comment:"Color Directed Messages (@Username)",def:true,customCss:[".chat_line_directed {","color: #0000FF;","font-weight: bold;","}",".chat_line_directed_username {","color: #FF0000;","}"],predicate:T},{name:"TppGUIConvertALLCAPS",comment:"Convert ALLCAPS to lowercase",def:true,customCss:[],predicate:N}];var L=function(){function u(){var e=f("#twitch_chat .js-chat-scroll");if(u.baseHeight==undefined)u.baseHeight=parseInt(e.css("bottom"));e.css("bottom",u.baseHeight+f("#TppControlPanel").height()+f(s).height())}var e=f("#chat_line_list");var t=[];S.forEach(function(e){var n=e.name;t.push("#chat_line_list."+n+" li."+n+"{display:none}")});C.forEach(function(e){e.customCss.forEach(function(e){t.push(e)})});var n=document.createElement("style");n.appendChild(document.createTextNode(t.join("")));var r=document.createElement("div");r.id="TppControlPanel";r.className="hidden";var i=document.createElement("table");r.appendChild(i);S.forEach(function(t){var n=document.createElement("tr");i.appendChild(n);var r;r=document.createElement("td");var s=document.createElement("input");s.type="checkbox";s.checked=t.def;r.appendChild(s);n.appendChild(r);r=document.createElement("td");r.appendChild(document.createTextNode(t.comment));n.appendChild(r);if(t.def){e.addClass(t.name)}f(s).click(function(){e.toggleClass(t.name)})});C.forEach(function(e){var t=document.createElement("tr");i.appendChild(t);var n;n=document.createElement("td");var r=document.createElement("input");r.type="checkbox";r.checked=e.def;n.appendChild(r);t.appendChild(n);n=document.createElement("td");n.appendChild(document.createTextNode(e.comment));t.appendChild(n);if(e.def){}f(r).click(function(){e.def=!e.def})});var s=document.createElement("button");s.appendChild(document.createTextNode("Chat Filter settings"));f(s).click(function(){f(r).toggleClass("hidden")});var o=document.getElementById("controls");document.body.appendChild(n);o.appendChild(s);o.appendChild(r);f(s).click(u);u()};var A=function(){var e=u.CurrentChat;f("#chat_line_list li").each(function(){var e=f(this);var t=e.find(".chat_line").text();var n=f(this)["0"].innerHTML;var r=k(n,t);if(!(r===n)){n=n.replace('class="','style="display:none" class="original_message ')+r.replace('class="','class="modified_message ')}x(t).forEach(function(t){e.addClass(t)})});e.line_buffer=800;e.insert_with_lock_in=function(){var e=this.set_currently_scrolling;this.set_currently_scrolling=function(){};var t,n,r="",i=[];while(this.queue.length>0){t=this.queue.shift();if(t.linkid){var s=x(t.info.message).join(" ");t.line=t.line.replace('class="','class="'+s+" ");i.push({info:t.info,linkid:t.linkid});var o=k(t.line,t.info.message);if(!(o===t.line)){t.line=t.line.replace('class="','style="display:none" class="original_message ')+o.replace('class="','class="modified_message ')}}if(t.el==="#chat_line_list"){this.line_count+=1}if(n&&n!==t.el){f(n).append(r);r=""}n=t.el;r+=t.line}if(n){f(n).append(r)}for(var u=0;u<i.length;u++){t=i[u];this.setup_viewer_handlers(t.info,t.linkid)}if(this.line_count>this.line_buffer){var a=f("#chat_line_list li:hidden");this.line_count-=a.length;a.remove();if(this.line_count>this.line_buffer){var l=f("#chat_line_list li:lt("+(this.line_count-this.line_buffer)+")");this.line_count-=l.length;l.remove()}if(this.history_ended){this.scroll_chat()}}var c=this;setTimeout(function(){if(c.history_ended){c.scroll_chat();c.set_currently_scrolling=e;c.appending=false}},1)}};f(function(){L();var e=setInterval(function(){if(f("#chat_loading_spinner").css("display")=="none"){clearInterval(e);A()}},100)})})()
